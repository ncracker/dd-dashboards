{"title":"Airflow Audit","description":"","widgets":[{"id":884453911795720,"definition":{"title":"User Activity in Airflow Server UI - Unique Count","type":"group","background_color":"vivid_green","show_title":true,"layout_type":"ordered","widgets":[{"id":1395292733920194,"definition":{"title":"Viewed DAGs","title_size":"16","title_align":"left","time":{},"type":"query_value","requests":[{"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:(tree OR graph OR duration OR tries OR landing_times OR gantt)"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}},"conditional_formats":[{"comparator":">","palette":"white_on_green","value":0}]}],"autoscale":true,"custom_links":[{"label":"DAG: {{$dag_id.value}}","link":"http://192.168.86.37:8080/tree?dag_id={{$dag_id.value}}"}],"precision":0},"layout":{"x":0,"y":0,"width":1,"height":1}},{"id":8082288159217246,"definition":{"title":"Tasks","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_green","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[],"compute":{"facet":"@task_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":1,"y":0,"width":1,"height":1}},{"id":1439100279682836,"definition":{"title":"D-Failures","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_red","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:failed"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":2,"y":0,"width":1,"height":1}},{"id":7117382753658098,"definition":{"title":"D-Triggered","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"black_on_light_yellow","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:trigger"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":3,"y":0,"width":1,"height":1}},{"id":871772600198914,"definition":{"title":"Events","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"black_on_light_green","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[],"compute":{"facet":"@id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":4,"y":0,"width":1,"height":4}},{"id":4146602137450496,"definition":{"title":"DAG Activity","title_size":"16","title_align":"left","type":"log_stream","indexes":[],"query":"source:postgresql service:airflow-dag-audit $dag_id","sort":{"column":"time","order":"desc"},"columns":["@dag_id","@event","host","service"],"show_date_column":true,"show_message_column":true,"message_display":"expanded-md"},"layout":{"x":5,"y":0,"width":7,"height":4}},{"id":7223250370131282,"definition":{"title":"T-Success","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_green","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:success"},"group_by":[],"compute":{"facet":"@task_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":0,"y":1,"width":1,"height":1}},{"id":8174729788465212,"definition":{"title":"T-Running","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_green","value":0}],"log_query":{"index":"*","search":{"query":"@event:running"},"group_by":[],"compute":{"aggregation":"count"}}}],"autoscale":true,"precision":2},"layout":{"x":1,"y":1,"width":1,"height":1}},{"id":4033917995234144,"definition":{"title":"T-Failures","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_red","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:failed"},"group_by":[],"compute":{"facet":"@task_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":2,"y":1,"width":1,"height":1}},{"id":5899194110553518,"definition":{"title":"T-TriggRun","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">=","palette":"black_on_light_yellow","value":0}],"log_query":{"index":"*","search":{"query":"@event:cli_task_run"},"group_by":[],"compute":{"facet":"@id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":3,"y":1,"width":1,"height":1}},{"id":3744011433684136,"definition":{"title":"D-set Success","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_green","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:dagrun_success"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":0,"y":2,"width":1,"height":1}},{"id":1494198224574890,"definition":{"title":"D-set Fail","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_red","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:dagrun_failed"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":1,"y":2,"width":1,"height":1}},{"id":1733695378783494,"definition":{"title":"D-Paused","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"white_on_yellow","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:paused"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":2,"y":2,"width":1,"height":1}},{"id":4161651846422920,"definition":{"title":"D-Reactivated","title_size":"16","title_align":"left","type":"query_value","requests":[{"conditional_formats":[{"comparator":">","palette":"green_on_white","value":0}],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:paused"},"group_by":[],"compute":{"facet":"@dag_id","aggregation":"cardinality"}}}],"autoscale":true,"precision":2},"layout":{"x":3,"y":2,"width":1,"height":1}},{"id":4285388752173482,"definition":{"title":"Task Status","title_size":"16","title_align":"left","type":"query_table","requests":[{"cell_display_mode":["number","number"],"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[{"facet":"@event","sort":{"facet":"@task_id","order":"desc","aggregation":"cardinality"},"limit":10}],"multi_compute":[{"facet":"@task_id","aggregation":"cardinality"},{"facet":"@dag_id","aggregation":"cardinality"}]}}],"has_search_bar":"auto"},"layout":{"x":0,"y":3,"width":4,"height":3}},{"id":7007773776234460,"definition":{"title":"Task Events","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"on_right_yaxis":false,"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[{"facet":"@dag_id","sort":{"facet":"@task_id","order":"desc","aggregation":"cardinality"},"limit":5},{"facet":"@task_id","sort":{"facet":"@task_id","order":"desc","aggregation":"cardinality"},"limit":5},{"facet":"@event","sort":{"facet":"@task_id","order":"desc","aggregation":"cardinality"},"limit":5}],"compute":{"facet":"@task_id","aggregation":"cardinality"}},"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":4,"width":4,"height":2}},{"id":3703564251174054,"definition":{"title":"Tasks Failed","title_size":"16","title_align":"left","type":"toplist","requests":[{"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit @event:failed"},"group_by":[{"facet":"@task_id","sort":{"facet":"@id","order":"desc","aggregation":"cardinality"},"limit":10}],"compute":{"facet":"@id","aggregation":"cardinality"}}}]},"layout":{"x":8,"y":4,"width":4,"height":2}},{"id":638092195737950,"definition":{"title":"DAG Run Task Duration","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"q":"avg:airflow.dag.task.duration.avg{$env,$dag_id} by {dag_id}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":6,"width":4,"height":2}},{"id":1888338689807712,"definition":{"title":"Pools Open/Used/Starving","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"q":"avg:airflow.pool.open_slots{$env,$dag_id}, avg:airflow.pool.used_slots{$env,$dag_id}, avg:airflow.pool.starving_tasks{$env,$dag_id}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":6,"width":4,"height":2}},{"id":2632140909980632,"definition":{"title":"DAG Bag Size","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"q":"avg:airflow.dagbag_size{$env,$dag_id}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]},"layout":{"x":8,"y":6,"width":4,"height":2}}]}},{"id":8684951904849848,"definition":{"title":"Single Pane of Glass","type":"group","background_color":"vivid_yellow","show_title":true,"layout_type":"ordered","widgets":[{"id":6602756517703120,"definition":{"title":"","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"avg:system.cpu.user{$env} by {host}"}},"node_type":"host","no_metric_hosts":true,"no_group_hosts":true,"group":["env"],"scope":["$env"],"style":{"palette":"green_to_orange","palette_flip":false}},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":4936178373443692,"definition":{"title":"","title_size":"16","title_align":"left","type":"event_timeline","query":"status:error","tags_execution":"and"},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":8363393403264398,"definition":{"title":"Top Tasks","title_size":"16","title_align":"left","type":"toplist","requests":[{"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[{"facet":"@task_id","sort":{"facet":"@id","order":"desc","aggregation":"cardinality"},"limit":10}],"compute":{"facet":"@id","aggregation":"cardinality"}}}]},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":1528312192290480,"definition":{"title":"Events: $env","title_size":"16","title_align":"left","type":"event_stream","query":"$env","tags_execution":"and","event_size":"s"},"layout":{"x":4,"y":2,"width":4,"height":4}},{"id":7919212720418146,"definition":{"title":"Top DAGs","title_size":"16","title_align":"left","type":"toplist","requests":[{"log_query":{"index":"*","search":{"query":"source:postgresql service:airflow-dag-audit"},"group_by":[{"facet":"@dag_id","sort":{"facet":"@id","order":"desc","aggregation":"cardinality"},"limit":10}],"compute":{"facet":"@id","aggregation":"cardinality"}}}]},"layout":{"x":8,"y":2,"width":4,"height":2}},{"id":4626751502771580,"definition":{"title":"","title_size":"16","title_align":"left","type":"scatterplot","requests":{"x":{"q":"avg:system.cpu.user{$env} by {service}","aggregator":"avg"},"y":{"q":"avg:system.mem.used{$env} by {service}","aggregator":"avg"}},"xaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"color_by_groups":[]},"layout":{"x":0,"y":4,"width":4,"height":2}},{"id":4989699811877794,"definition":{"title":"Live Processes","title_size":"16","title_align":"left","show_legend":false,"type":"timeseries","requests":[{"process_query":{"search_by":"","metric":"process.stat.cpu.total_pct","limit":10,"is_normalized_cpu":true,"filter_by":["$env"]},"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]},"layout":{"x":8,"y":4,"width":4,"height":2}}]},"layout":{"is_column_break":true}},{"id":7309410188679580,"definition":{"title":"Notifications & Alerts","type":"group","background_color":"pink","show_title":true,"layout_type":"ordered","widgets":[{"id":6845613988529312,"definition":{"type":"manage_status","summary_type":"monitors","display_format":"countsAndList","color_preference":"text","hide_zero_counts":true,"show_last_triggered":false,"query":"","sort":"status,asc","count":50,"start":0},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":743036688811684,"definition":{"title":"","title_size":"16","title_align":"left","type":"alert_graph","alert_id":"35257524","viz_type":"timeseries"},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":1467343165761836,"definition":{"title":"Check DB Status","title_size":"16","title_align":"left","type":"check_status","check":"postgres.can_connect","grouping":"cluster","group_by":["env"],"tags":["*"]},"layout":{"x":8,"y":0,"width":2,"height":2}},{"id":8333931320586802,"definition":{"title":"DB Deadlocks","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"avg:postgresql.deadlocks{*}","aggregator":"avg","conditional_formats":[{"comparator":">","palette":"white_on_red","value":0}]}],"autoscale":true},"layout":{"x":10,"y":0,"width":2,"height":2}},{"id":7775301199278634,"definition":{"title":"Avg DB Size","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"avg:postgresql.database_size{*}","aggregator":"avg"}],"autoscale":true,"precision":2},"layout":{"x":4,"y":2,"width":2,"height":2}},{"id":8218113634601908,"definition":{"title":"Avg Disk Read","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"avg:postgresql.disk_read{*}","aggregator":"avg"}],"autoscale":true,"precision":2},"layout":{"x":6,"y":2,"width":2,"height":2}},{"id":3338517306597074,"definition":{"title":"DB Conn","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"avg:postgresql.connections{*}","aggregator":"avg","conditional_formats":[{"comparator":">","palette":"white_on_red","value":15},{"comparator":">=","palette":"white_on_yellow","value":12},{"comparator":"<","palette":"white_on_green","value":12}]}],"autoscale":true,"precision":0},"layout":{"x":8,"y":2,"width":2,"height":2}},{"id":8557609848734292,"definition":{"title":"DB Available Conn","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"avg:postgresql.max_connections{*}-avg:postgresql.connections{*}","aggregator":"avg","conditional_formats":[{"comparator":"<","palette":"white_on_yellow","value":85}]}],"autoscale":true,"precision":0},"layout":{"x":10,"y":2,"width":2,"height":2}},{"id":6391666187988300,"definition":{"title":"Rows fetched / returned / inserted / updated (per sec)","show_legend":false,"type":"timeseries","requests":[{"q":"avg:postgresql.rows_fetched{*}"},{"q":"avg:postgresql.rows_returned{*}"},{"q":"avg:postgresql.rows_inserted{*}"},{"q":"avg:postgresql.rows_updated{*}"}]},"layout":{"x":4,"y":4,"width":4,"height":2}},{"id":8751691097810790,"definition":{"title":"I/O wait (%)","show_legend":false,"type":"timeseries","requests":[{"q":"max:system.cpu.iowait{*}"}]},"layout":{"x":8,"y":4,"width":4,"height":2}}]}}],"template_variables":[{"name":"dag_id","default":"*","prefix":"@dag_id"},{"name":"env","default":"*","prefix":"env"}],"layout_type":"ordered","is_read_only":false,"notify_list":[],"reflow_type":"fixed","id":"tsn-ci6-caz"}